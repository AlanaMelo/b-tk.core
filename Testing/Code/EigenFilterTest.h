#ifndef EigenFilterTest_h
#define EigenFilterTest_h

#include <btkEigen/SignalProcessing/Filter.h>
#include <btkEigen/SignalProcessing/IIRFilterDesign.h>
#include <btkConvert.h>

#include "EigenFilt_Util.h"

CXXTEST_SUITE(EigenFilterTest)
{
  CXXTEST_TEST(Butterworth_LowPass_2_0Dot5)
  {
    Eigen::Matrix<double,Eigen::Dynamic,1> x;
    generateRawData(x);
    Eigen::Matrix<double,Eigen::Dynamic,1> a,b;
    btkEigen::butter(&b, &a, 2, 0.5);
    Eigen::Matrix<double,Eigen::Dynamic,1> y = btkEigen::filter(b, a, x);
    
    Eigen::Matrix<double,Eigen::Dynamic,1> result(81,1);
    result << 0.078994393959063, 0.293680461518291, 0.609380263216319, 0.946431952108866, 1.149836173246444, 1.197611331288984, 1.232450178628516, 1.254621765667304, 1.019843119537853, 0.571983234713189, 
              0.269176503179677, 0.099607686508477,-0.172421820904401,-0.500779451295233,-0.711226206533147,-0.840222509725156,-0.830419999274584,-0.661291278146493,-0.488105261850835,-0.315180913270960,
              -0.112032247792902, 0.167090500562476, 0.476541594399677, 0.836334705655723, 1.201400420133043, 1.274854279299765, 1.140329566649642, 1.048678594787334, 0.966635438734780, 0.747496053757893, 
              0.404434589342732, 0.086235153615051,-0.205089573144154,-0.470258647788757,-0.726457650870339,-0.905243136643278,-0.828927377498028,-0.632743662037768,-0.504080465007461,-0.364170395195024,
              -0.154161885286635, 0.224808007840451, 0.665711683031317, 0.843881197919049, 0.919507586060895, 1.148025160831078, 1.334850948766730, 1.226109441098812, 0.895946914775277, 0.649412068757044,
              0.473242635616601, 0.147984746940540,-0.242538325450954,-0.576553839054406,-0.719547594074781,-0.641508996017767,-0.634892053949205,-0.672322742093992,-0.464487790441573,-0.131292243846836, 
              0.146262271061159, 0.404358040748561, 0.606842273082192, 0.750541284154185, 0.947178416749771, 1.090718719493036, 1.068618334381885, 1.080543912175484, 1.039055308050256, 0.741475258209657,
              0.417167318398736, 0.188711190787009,-0.095447600154962,-0.424576582058042,-0.675569990839884,-0.877678660751538,-0.915391589117641,-0.702574712465922,-0.498670536168534,-0.334128214554144,
              -0.061874352581106;
    
    TS_ASSERT_EQUALS(x.rows(), y.rows());
    TS_ASSERT_EQUALS(x.cols(), y.cols());
    for (int i = 0 ; i < x.rows() ; ++i)
      TSM_ASSERT_DELTA("Sample #" + btk::ToString(i), y.coeff(i), result.coeff(i), 1e-15);
  };
};

CXXTEST_SUITE_REGISTRATION(EigenFilterTest)
CXXTEST_TEST_REGISTRATION(EigenFilterTest, Butterworth_LowPass_2_0Dot5)

#endif // EigenFilterTest_h